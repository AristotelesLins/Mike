CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(80) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL
);

CREATE TABLE establishments (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(120) NOT NULL,
    user_id INT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE cameras (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(120) NOT NULL,
    camera_source VARCHAR(255) NOT NULL, -- Ex: '0' para webcam, ou um URL de stream
    establishment_id INT NOT NULL,
    FOREIGN KEY (establishment_id) REFERENCES establishments(id) ON DELETE CASCADE
);

CREATE TABLE known_faces (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(120) NOT NULL, -- 'Desconhecido_1', 'Desconhecido_2', etc. at√© ser nomeado
    face_encoding BLOB NOT NULL,
    user_id INT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE TABLE sightings (
    id INT AUTO_INCREMENT PRIMARY KEY,
    face_id INT NOT NULL,
    camera_id INT NOT NULL,
    timestamp DATETIME NOT NULL,
    FOREIGN KEY (face_id) REFERENCES known_faces(id) ON DELETE CASCADE,
    FOREIGN KEY (camera_id) REFERENCES cameras(id) ON DELETE CASCADE
);